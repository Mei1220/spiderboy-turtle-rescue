<!DOCTYPE html>
<html lang="en-us">
  <script src="https://pygame-web.github.io/archives/0.9/pythons.js" type="module" id="site"
    data-LINES="57" data-CONSOLE="25" data-python="python3.12" data-os="vtx,fs,snd,gui" async defer>
#<!--

print("""
Loading spiderboy-turtle-rescue from spiderboy-turtle-rescue.apk
    Pygbag Version : 0.9.2
    Template Version : 0.9.0
    Python  : 3.12
    CDN URL : https://pygame-web.github.io/archives/0.9/
    Screen  : 1280x720
    Title   : spiderboy-turtle-rescue
    Folder  : spiderboy-turtle-rescue
    Authors : pgw
    SPDX-License-Identifier: cookiecutter.spdx

""")

WIDTH = 1024
HEIGHT = 600
REFX = 1980
REFY = 1080

def u(real, ref, v):
    if abs(v) < 0.9999999:
        result = int((float(real)/100.0) * (v*1000))
        return real - result if v < 0 else result
    return int((real/ref) * v)

def ux(*argv):
    global WIDTH, REFX
    return sum(u(WIDTH, REFX, v) for v in argv)

def uy(*argv):
    global HEIGHT, REFY
    return sum(u(HEIGHT, REFY, v) for v in argv)

async def custom_site():
    import sys, asyncio, platform, json
    from pathlib import Path
    import embed, pygame

    platform.document.body.style.background = "#2e2e3e"

    def compose():
        pygame.display.update()
        window.chromakey(None, *screen.get_colorkey(), 40)

    pygame.init()
    pygame.font.init()

    screen = pygame.display.set_mode([ux(.100), uy(.100)], pygame.SRCALPHA, 32)
    screen.set_colorkey((0, 0, 0, 0), pygame.RLEACCEL)
    screen.fill((0, 0, 0, 0))
    compose()

    platform.window.transfer.hidden = True
    platform.window.canvas.style.visibility = "visible"

    apk = "spiderboy-turtle-rescue.apk"
    bundle = "spiderboy-turtle-rescue"
    appdir = Path(f"/data/data/{bundle}")
    appdir.mkdir()

    cfg = {
        "io": "url",
        "type": "mount",
        "mount": {"point": appdir.as_posix(), "path": "/"},
        "path": f"/ => {appdir.as_posix()}"
    }

    track = platform.window.MM.prepare(apk, json.dumps(cfg))
    marginx, marginy = ux(.020), uy(.045)

    def pg_bar(pos):
        total = track.len or 10
        slot = ux(.060) / total
        pygame.draw.rect(screen, (10, 10, 10), (marginx - ux(10), marginy - uy(10), (total * slot) + ux(20), uy(110)))
        pygame.draw.rect(screen, (30, 200, 90), (marginx, marginy, track.pos * slot, uy(90)))

    while not track.ready:
        pg_bar(track.pos)
        compose()
        await asyncio.sleep(.1)

    pg_bar(track.len)
    compose()

    platform.run_main(PyConfig, loaderhome=appdir / "assets", loadermain=None)
    while embed.counter() < 0:
        await asyncio.sleep(.1)

    main = appdir / "assets" / "main.py"
    await TopLevel_async_handler.start_toplevel(platform.shell, console=False)
    __import__(__name__).__file__ = str(main)

    fnt = pygame.sysfont.SysFont("freesans", uy(80))

    def ui_callback(pkg, error=None):
        prompt = fnt.render(f"{error}" if error else f"Setting [{pkg}] up", True, "white")
        pg_bar(track.len)
        screen.blit(prompt, (marginx + ux(80), marginy - uy(10)))
        compose()

    if not platform.window.MM.UME:
        prompt = fnt.render("â–¶ Click to Start SpiderBoy!", True, (255, 255, 255))
        pg_bar(track.len)
        screen.blit(prompt, (marginx + ux(80), marginy - uy(10)))
        compose()
        while not platform.window.MM.UME:
            await asyncio.sleep(.1)

    screen.fill((0, 0, 0, 0))
    pygame.display.flip()
    await shell.runpy(main, callback=ui_callback)

import asyncio
asyncio.run(custom_site())
#-->
</script>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SpiderBoy Turtle Rescue</title>
  <link rel="icon" type="image/png" href="favicon.png" sizes="16x16" />
  <script src="https://pygame-web.github.io/archives/0.9/browserfs.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background-color: #1c1b29;
      color: #fff;
    }

    #status {
      text-align: center;
      margin-top: 30px;
      font-size: 1.4em;
    }

    #progress {
      display: block;
      margin: 20px auto;
      width: 60%;
      height: 25px;
      background: #444;
      border-radius: 8px;
      overflow: hidden;
    }

    #progress::-webkit-progress-bar {
      background-color: #444;
    }

    #progress::-webkit-progress-value {
      background-color: #30c85f;
    }

    canvas.emscripten {
      width: 100%;
      height: 100%;
      background-color: transparent;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div id="transfer">
    <div id="status">Loading SpiderBoy Turtle Rescue...</div>
    <progress id="progress" value="0" max="100"></progress>
  </div>
  <canvas class="emscripten" id="canvas" width="1px" height="1px" oncontextmenu="event.preventDefault()" tabindex="1"></canvas>
</body>
</html>
